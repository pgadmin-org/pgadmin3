<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>CREATE TRIGGER</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 7.4beta2 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="SQL Commands"
HREF="sql-commands.html"><LINK
REL="PREVIOUS"
TITLE="CREATE TABLE AS"
HREF="sql-createtableas.html"><LINK
REL="NEXT"
TITLE="CREATE TYPE"
HREF="sql-createtype.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
NAME="creation"
CONTENT="2003-08-27T02:55:32"></HEAD
><BODY
CLASS="REFENTRY"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PostgreSQL 7.4beta2 Documentation</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sql-createtableas.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sql-createtype.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="SQL-CREATETRIGGER"
></A
>CREATE TRIGGER</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN40291"
></A
><H2
>Name</H2
>CREATE TRIGGER&nbsp;--&nbsp;define a new trigger</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN40294"
></A
><H2
>Synopsis</H2
><PRE
CLASS="SYNOPSIS"
>CREATE TRIGGER <VAR
CLASS="REPLACEABLE"
>name</VAR
> { BEFORE | AFTER } { <VAR
CLASS="REPLACEABLE"
>event</VAR
> [ OR ... ] }
    ON <VAR
CLASS="REPLACEABLE"
>table</VAR
> [ FOR [ EACH ] { ROW | STATEMENT } ]
    EXECUTE PROCEDURE <VAR
CLASS="REPLACEABLE"
>func</VAR
> ( <VAR
CLASS="REPLACEABLE"
>arguments</VAR
> )</PRE
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN40301"
></A
><H2
>Description</H2
><P
>   <TT
CLASS="COMMAND"
>CREATE TRIGGER</TT
> creates a new trigger.  The
   trigger will be associated with the specified table and will
   execute the specified function <VAR
CLASS="REPLACEABLE"
>func</VAR
> when certain events occur.
  </P
><P
>   The trigger can be specified to fire either before before the
   operation is attempted on a row (before constraints are checked and
   the <TT
CLASS="COMMAND"
>INSERT</TT
>, <TT
CLASS="COMMAND"
>UPDATE</TT
>, or
   <TT
CLASS="COMMAND"
>DELETE</TT
> is attempted) or after the operation has
   completed (after constraints are checked and the
   <TT
CLASS="COMMAND"
>INSERT</TT
>, <TT
CLASS="COMMAND"
>UPDATE</TT
>, or
   <TT
CLASS="COMMAND"
>DELETE</TT
> has completed). If the trigger fires
   before the event, the trigger may skip the operation for the
   current row, or change the row being inserted (for
   <TT
CLASS="COMMAND"
>INSERT</TT
> and <TT
CLASS="COMMAND"
>UPDATE</TT
> operations
   only). If the trigger fires after the event, all changes, including
   the last insertion, update, or deletion, are <SPAN
CLASS="QUOTE"
>"visible"</SPAN
>
   to the trigger.
  </P
><P
>   A trigger that is marked <VAR
CLASS="LITERAL"
>FOR EACH ROW</VAR
> is called
   once for every row that the operation modifies. For example, a
   <TT
CLASS="COMMAND"
>DELETE</TT
> that affects 10 rows will cause any
   <VAR
CLASS="LITERAL"
>ON DELETE</VAR
> triggers on the target relation to be
   called 10 separate times, once for each deleted row. In contrast, a
   trigger that is marked <VAR
CLASS="LITERAL"
>FOR EACH STATEMENT</VAR
> only
   executes once for any given operation, regardless of how many rows
   it modifies (in particular, an operation that modifies zero rows
   will still result in the execution of any applicable <VAR
CLASS="LITERAL"
>FOR
   EACH STATEMENT</VAR
> triggers).
  </P
><P
>   If multiple triggers of the same kind are defined for the same event,
   they will be fired in alphabetical order by name.
  </P
><P
>   <TT
CLASS="COMMAND"
>SELECT</TT
> does not modify any rows so you can not
   create <TT
CLASS="COMMAND"
>SELECT</TT
> triggers. Rules and views are more
   appropriate in such cases.
  </P
><P
>   Refer to <A
HREF="triggers.html"
>Chapter 37</A
> for more information about triggers.
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN40328"
></A
><H2
>Parameters</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><VAR
CLASS="REPLACEABLE"
>name</VAR
></DT
><DD
><P
>      The name to give the new trigger.  This must be distinct from
      the name of any other trigger for the same table.
     </P
></DD
><DT
><VAR
CLASS="LITERAL"
>BEFORE</VAR
><BR><VAR
CLASS="LITERAL"
>AFTER</VAR
></DT
><DD
><P
>      Determines whether the function is called before or after the
      event.
     </P
></DD
><DT
><VAR
CLASS="REPLACEABLE"
>event</VAR
></DT
><DD
><P
>      One of <TT
CLASS="COMMAND"
>INSERT</TT
>, <TT
CLASS="COMMAND"
>UPDATE</TT
>, or
      <TT
CLASS="COMMAND"
>DELETE</TT
>; this specifies the event that will
      fire the trigger. Multiple events can be specified using
      <VAR
CLASS="LITERAL"
>OR</VAR
>.
     </P
></DD
><DT
><VAR
CLASS="REPLACEABLE"
>table</VAR
></DT
><DD
><P
>      The name (optionally schema-qualified) of the table the trigger
      is for.
     </P
></DD
><DT
><VAR
CLASS="LITERAL"
>FOR EACH ROW</VAR
><BR><VAR
CLASS="LITERAL"
>FOR EACH STATEMENT</VAR
></DT
><DD
><P
>      This specifies whether the trigger procedure should be fired
      once for every row affected by the trigger event, or just once
      per SQL statement. If neither is specified, <VAR
CLASS="LITERAL"
>FOR EACH
      STATEMENT</VAR
> is the default.
     </P
></DD
><DT
><VAR
CLASS="REPLACEABLE"
>func</VAR
></DT
><DD
><P
>      A user-supplied function that is declared as taking no arguments
      and returning type <VAR
CLASS="LITERAL"
>trigger</VAR
>, which is executed when
      the trigger fires.
     </P
></DD
><DT
><VAR
CLASS="REPLACEABLE"
>arguments</VAR
></DT
><DD
><P
>      An optional comma-separated list of arguments to be provided to
      the function when the trigger is executed.  The arguments are
      literal string constants.  Simple names and numeric constants
      may be written here, too, but they will all be converted to
      strings.  Please check the description of the implementation
      language of the trigger function about how the trigger arguments
      are accessible within the function; it may be different from
      normal function arguments.
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN40376"
></A
><H2
>Diagnostics</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SAMP
CLASS="COMPUTEROUTPUT"
>CREATE TRIGGER</SAMP
></DT
><DD
><P
>      Message returned if the trigger was successfully created.
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="SQL-CREATETRIGGER-NOTES"
></A
><H2
>Notes</H2
><P
>   To create a trigger on a table, the user must have the
   <VAR
CLASS="LITERAL"
>TRIGGER</VAR
> privilege on the table.
  </P
><P
>   In <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> versions before 7.3, it was
   necessary to declare trigger functions as returning the placeholder
   type <TT
CLASS="TYPE"
>opaque</TT
>, rather than <TT
CLASS="TYPE"
>trigger</TT
>.  To support loading
   of old dump files, <TT
CLASS="COMMAND"
>CREATE TRIGGER</TT
> will accept a function
   declared as returning <TT
CLASS="TYPE"
>opaque</TT
>, but it will issue a notice and
   change the function's declared return type to <TT
CLASS="TYPE"
>trigger</TT
>.
  </P
><P
>   Use <A
HREF="sql-droptrigger.html"
><I
>DROP TRIGGER</I
></A
> to remove a trigger.
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="R1-SQL-CREATETRIGGER-2"
></A
><H2
>Examples</H2
><P
>   <A
HREF="trigger-example.html"
>Section 37.4</A
> contains a complete example.
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="SQL-CREATETRIGGER-COMPATIBILITY"
></A
><H2
>Compatibility</H2
><P
>   The <TT
CLASS="COMMAND"
>CREATE TRIGGER</TT
> statement in
   <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> implements a subset of the
   SQL99 standard.  (There are no provisions for triggers in SQL92.)
   The following functionality is missing:

   <P
></P
></P><UL
><LI
><P
>      SQL99 allows triggers to fire on updates to specific columns
      (e.g., <VAR
CLASS="LITERAL"
>AFTER UPDATE OF col1, col2</VAR
>).
     </P
></LI
><LI
><P
>      SQL99 allows you to define aliases for the <SPAN
CLASS="QUOTE"
>"old"</SPAN
>
      and <SPAN
CLASS="QUOTE"
>"new"</SPAN
> rows or tables for use in the definition
      of the triggered action (e.g., <VAR
CLASS="LITERAL"
>CREATE TRIGGER ... ON
      tablename REFERENCING OLD ROW AS somename NEW ROW AS othername
      ...</VAR
>).  Since <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>
      allows trigger procedures to be written in any number of
      user-defined languages, access to the data is handled in a
      language-specific way.
     </P
></LI
><LI
><P
>      <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> only allows the execution
      of a user-defined function for the triggered action.  SQL99
      allows the execution of a number of other SQL commands, such as
      <TT
CLASS="COMMAND"
>CREATE TABLE</TT
> as triggered action.  This
      limitation is not hard to work around by creating a user-defined
      function that executes the desired commands.
     </P
></LI
></UL
><P>
  </P
><P
>   SQL99 specifies that multiple triggers should be fired in
   time-of-creation order.  <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> uses
   name order, which was judged more convenient to work with.
  </P
><P
>   The ability to specify multiple actions for a single trigger using
   <VAR
CLASS="LITERAL"
>OR</VAR
> is a <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> extension of
   the SQL standard.
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN40425"
></A
><H2
>See Also</H2
><A
HREF="sql-createfunction.html"
><I
>CREATE FUNCTION</I
></A
>, <A
HREF="sql-altertrigger.html"
><I
>ALTER TRIGGER</I
></A
>, <A
HREF="sql-droptrigger.html"
><I
>DROP TRIGGER</I
></A
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-createtableas.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sql-createtype.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>CREATE TABLE AS</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sql-commands.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>CREATE TYPE</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>