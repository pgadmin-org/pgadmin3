<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>E.30. Release 7.4.2</title>
<link rel="stylesheet" href="stylesheet.css" type="text/css">
<link rev="made" href="pgsql-docs@postgresql.org">
<meta name="generator" content="DocBook XSL Stylesheets V1.71.1">
<link rel="start" href="index.html" title="PostgreSQL 8.2.0 Documentation">
<link rel="up" href="release.html" title="Appendix E. Release Notes">
<link rel="prev" href="release-7-4-3.html" title="E.29. Release 7.4.3">
<link rel="next" href="release-7-4-1.html" title="E.31. Release 7.4.1">
<link rel="copyright" href="ln-legalnotice.html" title="Legal Notice">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="sect1" lang="en">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="release-7-4-2"></a>E.30. Release 7.4.2</h2></div></div></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Release date</h3>
<p>2004-03-08</p>
</div>
<p>    This release contains a variety of fixes from 7.4.1.
   </p>
<div class="sect2" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="id2858672"></a>E.30.1. Migration to version 7.4.2</h3></div></div></div>
<p>     A dump/restore is not required for those running 7.4.X.  However,
     it may be advisable as the easiest method of incorporating fixes for
     two errors that have been found in the initial contents of 7.4.X system
     catalogs.  A dump/initdb/reload sequence using 7.4.2's initdb will
     automatically correct these problems.
    </p>
<p>     The more severe of the two errors is that data type <code class="type">anyarray</code>
     has the wrong alignment label; this is a problem because the
     <code class="structname">pg_statistic</code> system catalog uses <code class="type">anyarray</code>
     columns.  The mislabeling can cause planner misestimations and even
     crashes when planning queries that involve <code class="literal">WHERE</code> clauses on
     double-aligned columns (such as <code class="type">float8</code> and <code class="type">timestamp</code>).
     It is strongly recommended that all installations repair this error,
     either by initdb or by following the manual repair procedure given
     below.
    </p>
<p>     The lesser error is that the system view <code class="structname">pg_settings</code>
     ought to be marked as having public update access, to allow
     <code class="literal">UPDATE pg_settings</code> to be used as a substitute for
     <code class="command">SET</code>.  This can also be fixed either by initdb or manually,
     but it is not necessary to fix unless you want to use <code class="literal">UPDATE
     pg_settings</code>.
    </p>
<p>     If you wish not to do an initdb, the following procedure will work
     for fixing <code class="structname">pg_statistic</code>.  As the database superuser,
     do:

</p>
<pre class="programlisting">-- clear out old data in pg_statistic:
DELETE FROM pg_statistic;
VACUUM pg_statistic;
-- this should update 1 row:
UPDATE pg_type SET typalign = 'd' WHERE oid = 2277;
-- this should update 6 rows:
UPDATE pg_attribute SET attalign = 'd' WHERE atttypid = 2277;
--     
-- At this point you MUST start a fresh backend to avoid a crash!
--
-- repopulate pg_statistic:
ANALYZE;</pre>
<p>

     This can be done in a live database, but beware that all backends
     running in the altered database must be restarted before it is safe to
     repopulate <code class="structname">pg_statistic</code>.
    </p>
<p>     To repair the <code class="structname">pg_settings</code> error, simply do:
</p>
<pre class="programlisting">GRANT SELECT, UPDATE ON pg_settings TO PUBLIC;</pre>
<p>
    </p>
<p>     The above procedures must be carried out in <span class="emphasis"><em>each</em></span> database
     of an installation, including <code class="literal">template1</code>, and ideally
     including <code class="literal">template0</code> as well.  If you do not fix the
     template databases then any subsequently created databases will contain
     the same errors.  <code class="literal">template1</code> can be fixed in the same way
     as any other database, but fixing <code class="literal">template0</code> requires
     additional steps.  First, from any database issue
</p>
<pre class="programlisting">UPDATE pg_database SET datallowconn = true WHERE datname = 'template0';</pre>
<p>
      Next connect to <code class="literal">template0</code> and perform the above repair
      procedures.  Finally, do
</p>
<pre class="programlisting">-- re-freeze template0:
VACUUM FREEZE;
-- and protect it against future alterations:
UPDATE pg_database SET datallowconn = false WHERE datname = 'template0';</pre>
<p>
    </p>
</div>
<div class="sect2" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="id2858845"></a>E.30.2. Changes</h3></div></div></div>
<p>    Release 7.4.2 incorporates all the fixes included in release 7.3.6,
    plus the following fixes:</p>
<div class="itemizedlist"><ul type="disc">
<li>
<p>Fix <code class="structname">pg_statistics</code> alignment bug that could crash optimizer</p>
<p>See above for details about this problem.</p>
</li>
<li><p>Allow non-super users to update <code class="structname">pg_settings</code></p></li>
<li><p>Fix several optimizer bugs, most of which led to
&#8220;<span class="quote">variable not found in subplan target lists</span>&#8221; errors</p></li>
<li><p>Avoid out-of-memory failure during startup of large multiple
index scan</p></li>
<li><p>Fix multibyte problem that could lead to &#8220;<span class="quote">out of
memory</span>&#8221; error during <code class="command">COPY IN</code></p></li>
<li><p>Fix problems with <code class="command">SELECT INTO</code> / <code class="command">CREATE
TABLE AS</code> from tables without OIDs</p></li>
<li><p>Fix problems with <code class="filename">alter_table</code> regression test
during parallel testing</p></li>
<li><p>Fix problems with hitting open file limit, especially on OS X (Tom)</p></li>
<li>
<p>Partial fix for Turkish-locale issues</p>
<p>initdb will succeed now in Turkish locale, but there are still some
inconveniences associated with the <code class="literal">i/I</code> problem.</p>
</li>
<li><p>Make pg_dump set client encoding on restore</p></li>
<li><p>Other minor pg_dump fixes</p></li>
<li><p>Allow ecpg to again use C keywords as column names (Michael)</p></li>
<li><p>Added ecpg <code class="literal">WHENEVER NOT_FOUND</code> to
<code class="literal">SELECT/INSERT/UPDATE/DELETE</code> (Michael)</p></li>
<li><p>Fix ecpg crash for queries calling set-returning functions (Michael)</p></li>
<li><p>Various other ecpg fixes (Michael)</p></li>
<li><p>Fixes for Borland compiler</p></li>
<li><p>Thread build improvements (Bruce)</p></li>
<li><p>Various other build fixes</p></li>
<li><p>Various JDBC fixes</p></li>
</ul></div>
</div>
</div></body>
</html>
