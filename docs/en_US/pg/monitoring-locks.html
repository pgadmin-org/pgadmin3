<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Viewing Locks</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 7.4beta3 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="Monitoring Database Activity"
HREF="monitoring.html"><LINK
REL="PREVIOUS"
TITLE="The Statistics Collector"
HREF="monitoring-stats.html"><LINK
REL="NEXT"
TITLE="Monitoring Disk Usage"
HREF="diskusage.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
NAME="creation"
CONTENT="2003-09-15T14:41:50"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="5"
ALIGN="center"
VALIGN="bottom"
>PostgreSQL 7.4beta3 Documentation</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="monitoring-stats.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="monitoring.html"
>Fast Backward</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Chapter 23. Monitoring Database Activity</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="top"
><A
HREF="monitoring.html"
>Fast Forward</A
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="top"
><A
HREF="diskusage.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="MONITORING-LOCKS"
>23.3. Viewing Locks</A
></H1
><A
NAME="AEN19518"
></A
><P
>   Another useful tool for monitoring database activity is the
   <VAR
CLASS="LITERAL"
>pg_locks</VAR
> system table.  It allows the
   database administrator to view information about the outstanding
   locks in the lock manager. For example, this capability can be used
   to:
	
   <P
></P
></P><UL
><LI
><P
>      View all the locks currently outstanding, all the locks on
      relations in a particular database, all the locks on a
      particular relation, or all the locks held by a particular
      <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> session.
     </P
></LI
><LI
><P
>      Determine the relation in the current database with the most
      ungranted locks (which might be a source of contention among
      database clients).
     </P
></LI
><LI
><P
>      Determine the effect of lock contention on overall database
      performance, as well as the extent to which contention varies
      with overall database traffic.
     </P
></LI
></UL
><P>

   For more information on locking and managing concurrency with
   <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>, refer to <A
HREF="mvcc.html"
>Chapter 12</A
>.
  </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Note: </B
>    When the <VAR
CLASS="LITERAL"
>pg_locks</VAR
> view is accessed, the
    internal lock manager data structures are momentarily locked, and
    a copy is made for the view to display.  This ensures that the
    view produces a consistent set of results, while not blocking
    normal lock manager operations longer than necessary.  Nonetheless
    there could be some impact on database performance if this view is
    read often.
   </P
></BLOCKQUOTE
></DIV
><P
>   <A
HREF="monitoring-locks.html#MONITORING-LOCKS-TABLE"
>Table 23-3</A
> shows the definition of the
   <VAR
CLASS="LITERAL"
>pg_locks</VAR
> columns.  The
   <VAR
CLASS="LITERAL"
>pg_locks</VAR
> view contains one row per lockable
   object and requested lock mode.  Thus, the same lockable object may
   appear many times, if multiple transactions are holding or waiting
   for locks on it.  A lockable object is either a relation (e.g., a table) or a
   transaction ID.  (Note that this view includes only table-level
   locks, not row-level ones.  If a transaction is waiting for a
   row-level lock, it will appear in the view as waiting for the
   transaction ID of the current holder of that row lock.)
  </P
><DIV
CLASS="TABLE"
><A
NAME="MONITORING-LOCKS-TABLE"
></A
><P
><B
>Table 23-3. <VAR
CLASS="LITERAL"
>pg_locks</VAR
> Columns</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Column Name</TH
><TH
>Data Type</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="STRUCTFIELD"
>relation</TT
></TD
><TD
><TT
CLASS="TYPE"
>oid</TT
></TD
><TD
>       The OID of the locked relation, or null if the lockable object
       is a transaction ID. This column can be joined with the column <VAR
CLASS="LITERAL"
>oid</VAR
> of the
       <VAR
CLASS="LITERAL"
>pg_class</VAR
> system catalog to get more
       information on the locked relation.  Note however that this
       will only work for relations in the current database (those for
       which the <TT
CLASS="STRUCTFIELD"
>database</TT
> column is either
       the current database's OID or zero).
      </TD
></TR
><TR
><TD
><TT
CLASS="STRUCTFIELD"
>database</TT
></TD
><TD
><TT
CLASS="TYPE"
>oid</TT
></TD
><TD
>       The OID of the database in which the locked relation exists, or
       null if the lockable object is a transaction ID.  If the lock
       is on a globally-shared table, this field will be zero. This
       column can be joined with the column <VAR
CLASS="LITERAL"
>oid</VAR
> of the <VAR
CLASS="LITERAL"
>pg_database</VAR
>
       system catalog to get more information on the locked object's
       database.
      </TD
></TR
><TR
><TD
><TT
CLASS="STRUCTFIELD"
>transaction</TT
></TD
><TD
><TT
CLASS="TYPE"
>xid</TT
></TD
><TD
>       The ID of a transaction, or null if the lockable object is a
       relation.  Every transaction holds an exclusive lock on its
       transaction ID for its entire duration.  If one transaction
       finds it necessary to wait specifically for another
       transaction, it does so by attempting to acquire share lock on
       the other transaction ID.  That will succeed only when the
       other transaction terminates and releases its locks.
      </TD
></TR
><TR
><TD
><TT
CLASS="STRUCTFIELD"
>pid</TT
></TD
><TD
><TT
CLASS="TYPE"
>integer</TT
></TD
><TD
>       The process ID of the <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>
       server process belonging to the session that has acquired or is
       attempting to acquire the lock. If you have enabled the
       statistics collector, this column can be joined with the column
       <VAR
CLASS="LITERAL"
>pg_stat_activity</VAR
> view to get more
       information on the session holding or waiting to hold the
       lock.
      </TD
></TR
><TR
><TD
><TT
CLASS="STRUCTFIELD"
>mode</TT
></TD
><TD
><TT
CLASS="TYPE"
>text</TT
></TD
><TD
>       The mode of the requested or held lock on the lockable
       object. For more information on the different lock modes
       available in <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>, refer to
       <A
HREF="mvcc.html"
>Chapter 12</A
>.
      </TD
></TR
><TR
><TD
><TT
CLASS="STRUCTFIELD"
>isgranted</TT
></TD
><TD
><TT
CLASS="TYPE"
>boolean</TT
></TD
><TD
>       True if this lock has been granted (is held by this session).
       False indicates that this session is currently waiting to
       acquire this lock, which implies that some other session is
       holding a conflicting lock mode on the same lockable object.
       The waiting session will sleep until the other lock is released (or a
       deadlock situation is detected). A single session can be
       waiting to acquire at most one lock at a time.
      </TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="monitoring-stats.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="diskusage.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>The Statistics Collector</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="monitoring.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Monitoring Disk Usage</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>